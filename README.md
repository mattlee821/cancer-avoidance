# Cancer avoidance 

Provide a **brief** overview of:

- Project objective
The aim of this project is to investigate whether molecular traits explain variation in why individuals with high (geneitc/lifestyle) risk of developing cancer X do not develop develop cancer X. 

- Data summary
Data from the European Prospective Investigation into Cancer and Nutrition (EPIC) will be used. EPIC is a prospective cohort with data from >500,000 individuals, including baseline characteristics and blood samples and follow-up, including from cancer registries and death certificates.

- General analysis methods


# Project  Structure  

This project is organised into the following directories:  

- `analysis/` – Stores temporary script results.
- `code_review/` – Helps a "code buddy" reproduce manuscripts, presentations, and reports.
- `data/` –  Contains raw and processed data.
- `manuscripts/`, `presentations/`, and `reports/` – Store outputs for different sub-projects.
- `src/` – Houses code files for generating outputs.

### `data/`
**Do not keep multiple copies** of the data.

- **Raw Data**: Describe its source, location, or how to regenerate it if applicable.
  - `raw/PGS/` contains temp and converted genetic files for creating polygenic score files
  
- **Processed Data**: Document preprocessing steps and scripts used.

### `code_review/`

Provide details to help a reviewer reproduce your work.

### `manuscripts/`, `presentations/`, and `reports/`

- Each figure/table must have an associated script or reference to its source in src/.

- Avoid redundant copies; outputs should be generated by scripts. Example: figure `manuscript/figures/001_fabulous_figure.png`, must be generated by a script with the same name and location: `manuscript/figures/001_fabulous_figure.R`.

### `src/`

- `002_PGS/`
  - contains scripts that will create temp and converted genetic data files for use when calculating polygenic scores
  - `001_snplist.sh` = creates files of all SNPs from genetic data
  - `002_intersect.sh` = creates an snplist file which contains all snps present in all genetic data files using the output of `001_snplist.sh`
  - `003_convert-PLINK.sh` = creates bfiles from pfiles and only keeps the snps present in all genetic data files using the output of `002_intersect.sh`
  - `004_merge-PLINK.sh` = merges all converted bfiles from `003_convert-PLINK.sh` into a single bfile
  - `005_PGS-combined.sh` = calcualtes polygenic scores for all individuals using the output of `004_merge-PLINK.sh`
  - `005_PGS-individual.sh` = calcualtes polygenic scores for all individuals using the individual EPIC study genetic files `004_merge-PLINK.sh`
  - NOTE: for the `005_PGS*.sh` scripts to run you need to create a `samplesheet*.csv` file: col1 is ID name; col2 is genetic file (do not include suffix e.g., .bed); col3 is blank if CHR combined or CHR name if not; col4 is file format (pfile/bfile for EPIC)
  - NOTE: the reason we do `005_PGS*.sh` using the combined genetic data and for studies individually is because some studies have low sample sizes and calculating scores in low sample sizes is not recommended. By doing it both ways we can compare the scores.
  - NOTE: information on polygenic scores and the methods/code used in `005_PGS*.sh` can be found [here](https://embl-ebi.cloud.panopto.eu/Panopto/Pages/Viewer.aspx?id=274f9879-258d-4570-be9e-b23c011e72cd)
  - NOTE: see below section on PGS for insturctions on getting the `pgsc_calc` working
  - `006_PGS-check.R` = simple plots to check distributions
  
---

## Notes  

### `pgsc_calc`
All software/data needed are in `/data/IARC_Biostat/work/tools/pgsc_calc/`. 
The `pgsc_calc` requires java V17> and nextflow V25>. To check the java version:

```bash
java -version
```

You can download openJDK and extract as
```bash
cd /data/IARC_Biostat/work/tools/pgsc_calc/
wget https://download.java.net/java/GA/jdk24.0.1/24a58e0e276943138bf3e963e6291ac2/9/GPL/openjdk-24.0.1_linux-x64_bin.tar.gz
tar -xzf openjdk-24.0.1_linux-x64_bin.tar.gz
```

Then you can assign to your PATH (needs to be done for all submission jobs)
```bash
export JAVA_HOME=/data/IARC_Biostat/work/tools/pgsc_calc/jdk-24.0.1
export PATH="$JAVA_HOME/bin:$PATH"
```

Now you can download the msot recent nextflow
```bash
cd /data/IARC_Biostat/work/tools/pgsc_calc/
curl -fsSL get.nextflow.io | bash
```

Finally you can run the test `pgsc_calc` profile. This will take a while as it does installs the first time.
```bash
cd /data/IARC_Biostat/work/tools/pgsc_calc/
nextflow run pgscatalog/pgsc_calc \
	-profile test,singularity \
	--outdir test-results
```
The output will be in `/data/IARC_Biostat/work/tools/pgsc_calc/work/test-results/`. If there were no errors and it worked you can check the report `work/test-results/cineca/score/report.html`. If it doesnt work then go to the github and see if anyone has had similar issues...

It is also useful to download the available reference data so you can do ancestry correction when calculating the scores:
```bash
cd /data/IARC_Biostat/work/tools/pgsc_calc/
wget https://ftp.ebi.ac.uk/pub/databases/spot/pgs/resources/pgsc_HGDP+1kGP_v1.tar.zst
```


## [Optional] Future Improvements

List potential enhancements or next steps.